- hosts: localhost
  any_errors_fatal: true

  roles:
    - { role: johanneskastl.disable_cloud-init_services }

  environment:

  vars:
    ansible_python_interpreter: /usr/bin/python3
    selinux: false
    asterisk_user: asterisk
    asterisk_group: asterisk
    dahdi_linux_version: v2.11.1
    dahdi_tools_version: v2.11.1
    libpri_version: 1.4.15
    starpy_version: 1.0.3
    jansson_version: v2.14
    asterisk_version: 13.7.2
    cdr_pgsql_hostname: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31626233343164316666373561393564643638363361363439626266383438313761383733643264
          6335393334323466323862346631313936633230326430320a356330383938303065313163343836
          38393732636536353862363335373439343466643762373064653766636632653765336565626663
          6363633865373139330a326563663337303836633265353839363534356364343135663566326566
          3961
    cdr_pgsql_port: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37353862633335323031623566386263646135656462663339343161316138663935333734346236
          3132333563336362333665363130633363616530326536320a653338323637306164366166353836
          65366466353233643233326465343963353731353830646535656236383863613438666361323430
          3331383362633063390a623639336334626136653031663030663234613165333663643737643637
          3034
    cdr_pgsql_dbname: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37613937303430653634313338303636323133376362303633366134373862343937363338643538
          3262663233633966663430386436316264626338393632660a616561316635366135356631333661
          64613962656632653039646162666236643961323762363031613832663431333965666164386532
          3436303435366562340a643432393931333639316534356134383739343063353363653436353564
          3439
    cdr_pgsql_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36333038353231366338663233383461353932313630343936626561333534356436633735306334
          3466663763313564633533393131353161303230333238390a333937396231633366346538363364
          35386364333462663331633565373930393238386139646538363132326432656563346230356239
          3435386238386639650a616631616363373564353332353837306165346665616664363432616531
          34363237376432663261653336383766363638393865363632396133363030613266
    cdr_pgsql_user: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32363339313434373762373066663932353034333433376462303439613965656531326365336562
          6235613864636263653966323538313033306439613064650a653134666238373439396239376264
          66353632323963373830383138616436313832326537613530326237353932653063323031663630
          6166323835306539390a363264393432326464316466333930326565646436363739623331396664
          3231
    cdr_pgsql_table: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39636265653565313231386561656363656662623864373735623664383863303563333734343936
          3733373638343936653466383737373431306337303538370a636333373131646361393662313662
          63313635653533383938343863343632363332656365383938666662393165626534653930386162
          3739656639363765620a373261643730643331303839356463623361333661343863333665663662
          3837
    manager_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64383264656634376331306462366633353031363438363863316164646634393633366565663566
          6439646130353662306530363663663330373937623664300a383238653933626231316339623366
          38376536626133663765303036626630373565636539383531356333656336356161326666396263
          6638326632333564310a646536643865393030663930623762653466323566303233623235323166
          3534

  tasks:
    - name: disable selinux
      selinux:
        state: disabled
      when: selinux|default(false)|bool == false
    - import_tasks: tasks/packages.yml
    - import_tasks: tasks/application.yml

  post_tasks:
    - name: update all system packages
      dnf:
        name:  "*"
        state: latest

    - name: Restart
      command: 'shutdown -r +1'
      async: 0
      poll: 0
      ignore_errors: true
